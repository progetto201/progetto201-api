<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>progetto201 API: api/sensors/data.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">progetto201 API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_0188a3e6da905bc60aceb35bf790b8c9.html">api</a></li><li class="navelem"><a class="el" href="dir_c9da79db099114cf1c7ae2debe19d9fc.html">sensors</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">data.php File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><b>DATA</b>: manages sensors data.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:aa38e4f0af480e059e8121fd28f79114e"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="data_8php.html#aa38e4f0af480e059e8121fd28f79114e">getOptions</a> ($t_conn_res)</td></tr>
<tr class="memdesc:aa38e4f0af480e059e8121fd28f79114e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns user's options from the t_options table.  <a href="data_8php.html#aa38e4f0af480e059e8121fd28f79114e">More...</a><br /></td></tr>
<tr class="separator:aa38e4f0af480e059e8121fd28f79114e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a99f560ad0ae5d8b9707effd068a77aad"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="data_8php.html#a99f560ad0ae5d8b9707effd068a77aad">getNodetype</a> ($t_conn_res, $nodeid)</td></tr>
<tr class="memdesc:a99f560ad0ae5d8b9707effd068a77aad"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the node type of a node with id $nodeid.  <a href="data_8php.html#a99f560ad0ae5d8b9707effd068a77aad">More...</a><br /></td></tr>
<tr class="separator:a99f560ad0ae5d8b9707effd068a77aad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a30bb48b8b324457b5453ee7580837f67"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="data_8php.html#a30bb48b8b324457b5453ee7580837f67">getDataType0</a> ($t_conn_res, $nodeid, $min_timestamp, $max_timestamp)</td></tr>
<tr class="memdesc:a30bb48b8b324457b5453ee7580837f67"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns data of the node type 0, with id $nodeid.  <a href="data_8php.html#a30bb48b8b324457b5453ee7580837f67">More...</a><br /></td></tr>
<tr class="separator:a30bb48b8b324457b5453ee7580837f67"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0cdaf0785f61e85d4ebb6fceb1370e12"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="data_8php.html#a0cdaf0785f61e85d4ebb6fceb1370e12">getData</a> ($t_conn_res)</td></tr>
<tr class="memdesc:a0cdaf0785f61e85d4ebb6fceb1370e12"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the data of the node id requested by calling the correct getDataTypeX() function.  <a href="data_8php.html#a0cdaf0785f61e85d4ebb6fceb1370e12">More...</a><br /></td></tr>
<tr class="separator:a0cdaf0785f61e85d4ebb6fceb1370e12"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="data_8php.html#af4b6fb1bbc77ccc05f10da3b16935b99">$response</a> = array(&quot;errors&quot; =&gt; array())</td></tr>
<tr class="memdesc:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare default response array with no errors.  <a href="data_8php.html#af4b6fb1bbc77ccc05f10da3b16935b99">More...</a><br /></td></tr>
<tr class="separator:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><b>DATA</b>: manages sensors data. </p>
<p>Client perspective:</p><ul>
<li><b>GET</b> METHOD --&gt; returns the data of a sensor</li>
</ul>
<h2><a class="anchor" id="autotoc_md19"></a>
Description</h2>
<p>This script sets the returned <b>content type to JSON</b>, <b>includes the <a class="el" href="db__connection_8php.html" title="DB_CONNECTION: manages database connection and queries.">db_connection.php</a> script</b> </p><blockquote class="doxtable">
<p>It is used to connect to MySQL and execute basic SELECT queries </p>
</blockquote>
<p>and then defines the response array.</p>
<p>Many functions are defined: </p><pre class="fragment"> getOptions()
</pre><p> Returns user's options from the t_options table. </p><pre class="fragment"> getNodetype()
</pre><p> Returns the node type of a node with id $nodeid. </p><pre class="fragment"> getData()
</pre><p> Returns the data of the node id requested by calling the correct getDataTypeX() function. </p><pre class="fragment"> getDataType0()
</pre><p> Returns data of the node type 0, with id $nodeid.</p>
<p>If the script isn't included it tries to connect to the database, and checks the request method:</p><ul>
<li>if the method is GET it calls the <a class="el" href="data_8php.html#a0cdaf0785f61e85d4ebb6fceb1370e12" title="Returns the data of the node id requested by calling the correct getDataTypeX() function.">getData()</a> function <blockquote class="doxtable">
<p>Which calls all the other functions </p>
</blockquote>
</li>
</ul>
<p>When the called function ends the connection to the DB gets terminated, and data (or errors) is collected inside the response array. The response array gets echoed to the client in JSON format</p>
<p>Errors list:</p><ul>
<li><b>900</b> - main: Method not supported by the target resource</li>
<li><b>901</b> - main: No data but also No errors</li>
<li><b>910</b> - <a class="el" href="data_8php.html#a99f560ad0ae5d8b9707effd068a77aad" title="Returns the node type of a node with id $nodeid.">getNodetype()</a>: Query returned nothing</li>
<li><b>911</b> - <a class="el" href="data_8php.html#a99f560ad0ae5d8b9707effd068a77aad" title="Returns the node type of a node with id $nodeid.">getNodetype()</a>: Error executing query</li>
<li><b>920</b> - <a class="el" href="data_8php.html#a30bb48b8b324457b5453ee7580837f67" title="Returns data of the node type 0, with id $nodeid.">getDataType0()</a>: Query returned nothing</li>
<li><b>921</b> - <a class="el" href="data_8php.html#a30bb48b8b324457b5453ee7580837f67" title="Returns data of the node type 0, with id $nodeid.">getDataType0()</a>: Error executing query</li>
<li><b>930</b> - <a class="el" href="data_8php.html#a0cdaf0785f61e85d4ebb6fceb1370e12" title="Returns the data of the node id requested by calling the correct getDataTypeX() function.">getData()</a>: can't get data for this node type (not supported)</li>
<li><b>931</b> - <a class="el" href="data_8php.html#a0cdaf0785f61e85d4ebb6fceb1370e12" title="Returns the data of the node id requested by calling the correct getDataTypeX() function.">getData()</a>: nodeid is not set in the request</li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Stefano Zenaro (<a href="https://github.com/mario33881">https://github.com/mario33881</a>) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a0cdaf0785f61e85d4ebb6fceb1370e12"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a0cdaf0785f61e85d4ebb6fceb1370e12">&#9670;&nbsp;</a></span>getData()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getData </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the data of the node id requested by calling the correct getDataTypeX() function. </p>
<p>First checks if a node id was specified in the request, then gets the timestamps from the options table by calling the <a class="el" href="data_8php.html#aa38e4f0af480e059e8121fd28f79114e" title="Returns user&#39;s options from the t_options table.">getOptions()</a> function.</p>
<p>Next it gets the node type of the node by calling the <a class="el" href="data_8php.html#a99f560ad0ae5d8b9707effd068a77aad" title="Returns the node type of a node with id $nodeid.">getNodetype()</a> function. Based on the node type, the correct function is called to collect the data of that node.</p>
<p>Example:</p><ul>
<li>if the node type is "0", the table is "t_type0_data" and the function that collects the data is called <a class="el" href="data_8php.html#a30bb48b8b324457b5453ee7580837f67" title="Returns data of the node type 0, with id $nodeid.">getDataType0()</a></li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the DB connection object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $action_res array with errors or data </dd></dl>

</div>
</div>
<a id="a30bb48b8b324457b5453ee7580837f67"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a30bb48b8b324457b5453ee7580837f67">&#9670;&nbsp;</a></span>getDataType0()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getDataType0 </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$nodeid</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$min_timestamp</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$max_timestamp</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns data of the node type 0, with id $nodeid. </p>
<p>If the request has a "latest" parameter, return the last data from that node, else check if the client wants all the data ($min_timestamp e $max_timestamp are zero) or part of the data ( $min_timestamp &lt;= timestamp &lt;= $max_timestamp).</p>
<p>The data is then returned by the function.</p>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the DB connection object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$nodeid</td><td>integer that identifies the node </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$min_timestamp</td><td>timestamp set as the start date for data plotting </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$max_timestamp</td><td>timestamp set as the end date for data plotting </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $action_res array with errors or data </dd></dl>

</div>
</div>
<a id="a99f560ad0ae5d8b9707effd068a77aad"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a99f560ad0ae5d8b9707effd068a77aad">&#9670;&nbsp;</a></span>getNodetype()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getNodetype </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$nodeid</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the node type of a node with id $nodeid. </p>
<p>The function selects the type id using the node id.</p>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the DB connection object </td></tr>
    <tr><td class="paramtype">int</td><td class="paramname">$nodeid</td><td>integer that identifies the node </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $action_res array with errors or data </dd></dl>

</div>
</div>
<a id="aa38e4f0af480e059e8121fd28f79114e"></a>
<h2 class="memtitle"><span class="permalink"><a href="#aa38e4f0af480e059e8121fd28f79114e">&#9670;&nbsp;</a></span>getOptions()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">getOptions </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns user's options from the t_options table. </p>
<p>It executes the SELECT query to get this data:</p><ul>
<li>color_scheme: color name selected by the user</li>
<li>min_timestamp: timestamp set as the start date for data plotting</li>
<li>max_timestamp: timestamp set as the end date for data plotting</li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the DB connection object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $query_arr array with errors or data </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af4b6fb1bbc77ccc05f10da3b16935b99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4b6fb1bbc77ccc05f10da3b16935b99">&#9670;&nbsp;</a></span>$response</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$response = array(&quot;errors&quot; =&gt; array())</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare default response array with no errors. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
