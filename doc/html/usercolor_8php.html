<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "https://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.16"/>
<meta name="viewport" content="width=device-width, initial-scale=1"/>
<title>progetto201 API: www/html/api/colors/usercolor.php File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/searchdata.js"></script>
<script type="text/javascript" src="search/search.js"></script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td id="projectalign" style="padding-left: 0.5em;">
   <div id="projectname">progetto201 API
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.16 -->
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
var searchBox = new SearchBox("searchBox", "search",false,'Search');
/* @license-end */
</script>
<script type="text/javascript" src="menudata.js"></script>
<script type="text/javascript" src="menu.js"></script>
<script type="text/javascript">
/* @license magnet:?xt=urn:btih:cf05388f2679ee054f2beb29a391d25f4e673ac3&amp;dn=gpl-2.0.txt GPL-v2 */
$(function() {
  initMenu('',true,false,'search.php','Search');
  $(document).ready(function() { init_search(); });
});
/* @license-end */</script>
<div id="main-nav"></div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
</div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_5b91fe896655279d6afeb67d8a39e692.html">www</a></li><li class="navelem"><a class="el" href="dir_f7d3756803691839d6b25fb7b08f97b6.html">html</a></li><li class="navelem"><a class="el" href="dir_2588d0ba178b9f5c214f6d04d44e95ad.html">api</a></li><li class="navelem"><a class="el" href="dir_e2c07cdc0b343451123cde84585f54e9.html">colors</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#func-members">Functions</a> &#124;
<a href="#var-members">Variables</a>  </div>
  <div class="headertitle">
<div class="title">usercolor.php File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p><b>USERCOLOR</b>: manages user's color.  
<a href="#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a8a716faa30eaeb7c11eb9caa2cf25698"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usercolor_8php.html#a8a716faa30eaeb7c11eb9caa2cf25698">get_usercolor</a> ($t_conn_res)</td></tr>
<tr class="memdesc:a8a716faa30eaeb7c11eb9caa2cf25698"><td class="mdescLeft">&#160;</td><td class="mdescRight">Returns the UI color data inside the 'data' property of an array.  <a href="usercolor_8php.html#a8a716faa30eaeb7c11eb9caa2cf25698">More...</a><br /></td></tr>
<tr class="separator:a8a716faa30eaeb7c11eb9caa2cf25698"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a176c198f2f3fd8b18def0f3ca7cfd858"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usercolor_8php.html#a176c198f2f3fd8b18def0f3ca7cfd858">post_usercolor</a> ($t_conn_res)</td></tr>
<tr class="memdesc:a176c198f2f3fd8b18def0f3ca7cfd858"><td class="mdescLeft">&#160;</td><td class="mdescRight">Set's the new UI color passed by the client.  <a href="usercolor_8php.html#a176c198f2f3fd8b18def0f3ca7cfd858">More...</a><br /></td></tr>
<tr class="separator:a176c198f2f3fd8b18def0f3ca7cfd858"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="var-members"></a>
Variables</h2></td></tr>
<tr class="memitem:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="memItemLeft" align="right" valign="top">&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="usercolor_8php.html#af4b6fb1bbc77ccc05f10da3b16935b99">$response</a> = array('errors' =&gt; array())</td></tr>
<tr class="memdesc:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="mdescLeft">&#160;</td><td class="mdescRight">Prepare default response array with no errors.  <a href="usercolor_8php.html#af4b6fb1bbc77ccc05f10da3b16935b99">More...</a><br /></td></tr>
<tr class="separator:af4b6fb1bbc77ccc05f10da3b16935b99"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p><b>USERCOLOR</b>: manages user's color. </p>
<p>Client perspective:</p><ul>
<li><b>GET</b> METHOD --&gt; returns user color</li>
<li><b>POST</b> METHOD --&gt; retrieves user color</li>
</ul>
<h2><a class="anchor" id="autotoc_md15"></a>
Description</h2>
<p>This script sets the returned <b>content type to JSON</b>, <b>includes the <a class="el" href="db__connection_8php.html" title="DB_CONNECTION: manages database connection and queries.">db_connection.php</a> script</b> </p><blockquote class="doxtable">
<p>It is used to connect to MySQL and execute basic SELECT queries </p>
</blockquote>
<p>and then defines the response array.</p>
<p>Two functions are defined: </p><pre class="fragment">get_usercolor($t_conn_res)
</pre><p> Selects the user color from the database so that the script can echo it </p><pre class="fragment">post_usercolor($t_conn_res)
</pre><p> Sets the user color inside the options table (colors param must be passed)</p>
<p>If the script isn't included it tries to connect to the database, and checks the request method:</p><ul>
<li>if the method is GET it calls get_usercolor($t_conn_res)</li>
<li>if the method is POST it calls post_usercolor($t_conn_res)</li>
</ul>
<p>When the called function ends the connection to the DB gets terminated, and data (or errors) is collected inside the response array. The response array gets echoed to the client in JSON format</p>
<p>Errors list:</p><ul>
<li><b>200</b> - main: Method not supported by the target resource</li>
<li><b>201</b> - main: No data but also No errors</li>
<li><b>210</b> - <a class="el" href="usercolor_8php.html#a8a716faa30eaeb7c11eb9caa2cf25698" title="Returns the UI color data inside the &#39;data&#39; property of an array.">get_usercolor()</a>: The query returned an unexpected number of records</li>
<li><b>211</b> - <a class="el" href="usercolor_8php.html#a8a716faa30eaeb7c11eb9caa2cf25698" title="Returns the UI color data inside the &#39;data&#39; property of an array.">get_usercolor()</a>: Error during query execution</li>
<li><b>220</b> - <a class="el" href="usercolor_8php.html#a176c198f2f3fd8b18def0f3ca7cfd858" title="Set&#39;s the new UI color passed by the client.">post_usercolor()</a>: Unable to change the current color for the new one (the user sent the current color or a non existing one)</li>
<li><b>221</b> - <a class="el" href="usercolor_8php.html#a176c198f2f3fd8b18def0f3ca7cfd858" title="Set&#39;s the new UI color passed by the client.">post_usercolor()</a>: Unable to execute UPDATE query (query error)</li>
<li><b>222</b> - <a class="el" href="usercolor_8php.html#a176c198f2f3fd8b18def0f3ca7cfd858" title="Set&#39;s the new UI color passed by the client.">post_usercolor()</a>: Parameter 'color' wasn't set"</li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="section author"><dt>Author</dt><dd>Stefano Zenaro (<a href="https://github.com/mario33881">https://github.com/mario33881</a>) </dd></dl>
<dl class="section copyright"><dt>Copyright</dt><dd>MIT </dd></dl>
</div><h2 class="groupheader">Function Documentation</h2>
<a id="a8a716faa30eaeb7c11eb9caa2cf25698"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a8a716faa30eaeb7c11eb9caa2cf25698">&#9670;&nbsp;</a></span>get_usercolor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">get_usercolor </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Returns the UI color data inside the 'data' property of an array. </p>
<p>The function, using the mysqli object inside the parameter $t_conn_res ($t_conn_res['connect_obj']), executes the query '$query' which collects the color previously selected by the user. </p><blockquote class="doxtable">
<p>There is always a value (the default one is 'red'). </p>
</blockquote>
<p>If the query execution throws an error the error is collected inside the 'errors' property of the array (which is also an array). The errors inside the 'errors' array have three properties:</p><ul>
<li><b>id</b>: identifies the error, it is useful for the frontend</li>
<li><b>htmlcode</b>: it is the status code of the response that will be given to the client</li>
<li><b>message</b>: details of the error <blockquote class="doxtable">
<p>the message is in english, language translation is going to be managed from the frontend </p>
</blockquote>
</li>
</ul>
<p>The user's color data is an array and is structured as following:</p><ul>
<li><b>id</b>: identification number from the database</li>
<li><b>color_name</b>: name of the color</li>
<li><b>color_hex</b>: hexadecimal value of the color <blockquote class="doxtable">
<p>format of color_hex:</p><div class="fragment"><div class="line"><span class="preprocessor">#RRGGBB</span></div>
</div><!-- fragment --> </blockquote>
</li>
</ul>
<p>Example with no errors </p><div class="fragment"><div class="line">GET /api/colors/usercolor.php</div>
<div class="line">{</div>
<div class="line">  <span class="stringliteral">&quot;errors&quot;</span>: [],</div>
<div class="line">  <span class="stringliteral">&quot;data&quot;</span>: {</div>
<div class="line">      <span class="stringliteral">&quot;id&quot;</span>: <span class="stringliteral">&quot;4384&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;color_name&quot;</span>: <span class="stringliteral">&quot;red&quot;</span>,</div>
<div class="line">      <span class="stringliteral">&quot;color_hex&quot;</span>: <span class="stringliteral">&quot;#f44336&quot;</span></div>
<div class="line">  }</div>
<div class="line">}</div>
</div><!-- fragment --><p>If there are errors they will be pushed inside the errors array. Possible returned errors:</p><ul>
<li><b>210</b>: The query returned an unexpected number of records</li>
<li><b>211</b>: Error during query execution</li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the connection object (connection was successful) </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $action_res array with color data or errors </dd></dl>

</div>
</div>
<a id="a176c198f2f3fd8b18def0f3ca7cfd858"></a>
<h2 class="memtitle"><span class="permalink"><a href="#a176c198f2f3fd8b18def0f3ca7cfd858">&#9670;&nbsp;</a></span>post_usercolor()</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">post_usercolor </td>
          <td>(</td>
          <td class="paramtype">&#160;</td>
          <td class="paramname"><em>$t_conn_res</em></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Set's the new UI color passed by the client. </p>
<p>The function checks if a POST parameter called 'color' was passed, if so it executes the query that makes sure that the color exists inside the colors table and modifies the set color inside the options table. For last it checks if the query modified one row (as expected) and returns the color inside the 'data' property of the returned array.</p>
<p>Example with no errors </p><div class="fragment"><div class="line">POST /api/colors/usercolor.php (color=red)</div>
<div class="line">{</div>
<div class="line">  <span class="stringliteral">&quot;errors&quot;</span>: [],</div>
<div class="line">  <span class="stringliteral">&quot;data&quot;</span>: <span class="stringliteral">&quot;red&quot;</span></div>
<div class="line">}</div>
</div><!-- fragment --><p>If there are errors they will be pushed inside the errors array. Possible returned errors:</p><ul>
<li><b>220</b>: Unable to change the current color for the new one (the user sent the current color or a non existing one)</li>
<li><b>221</b>: Unable to execute UPDATE query (query error)</li>
<li><b>222</b>: Parameter 'color' wasn't set"</li>
</ul>
<p>The errors inside the 'errors' array have three properties:</p><ul>
<li><b>id</b>: identifies the error, it is useful for the frontend</li>
<li><b>htmlcode</b>: it is the status code of the response that will be given to the client</li>
<li><b>message</b>: details of the error <blockquote class="doxtable">
<p>the message is in english, language translation is going to be managed from the frontend </p>
</blockquote>
</li>
</ul>
<dl class="section since"><dt>Since</dt><dd>01_01 </dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramtype">array</td><td class="paramname">$t_conn_res</td><td>array with the connection object </td></tr>
  </table>
  </dd>
</dl>
<dl class="section return"><dt>Returns</dt><dd>array $action_res array with color data or errors </dd></dl>

</div>
</div>
<h2 class="groupheader">Variable Documentation</h2>
<a id="af4b6fb1bbc77ccc05f10da3b16935b99"></a>
<h2 class="memtitle"><span class="permalink"><a href="#af4b6fb1bbc77ccc05f10da3b16935b99">&#9670;&nbsp;</a></span>$response</h2>

<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">$response = array('errors' =&gt; array())</td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Prepare default response array with no errors. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.16
</small></address>
</body>
</html>
